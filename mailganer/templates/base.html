<!DOCTYPE html>

{% load static %}

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Рассылки</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{% static 'js/tinymce/tinymce.min.js' %}"></script>
    <script src="https://cdn.tiny.cloud/1/yfum3fz2yjwynohrs67dtxy3h14qbdyzlsumbi0pnfoy7e4o/tinymce/7/plugins.min.js" referrerpolicy="origin"></script>
  </head>

  <body class="d-flex flex-column min-vh-100">
    <main class="flex-grow-1">
      {% block content %}Контент{% endblock %}


      <script>
        tinymce.init({
          selector: '#id_message',
          language: 'ru',
          plugins: [
            'anchor', 'autolink', 'charmap', 'codesample', 'emoticons', 'image', 'link', 'lists', 'media', 'searchreplace', 'table', 'visualblocks', 'wordcount',
            'checklist', 'mediaembed', 'casechange', 'export', 'formatpainter', 'pageembed', 'a11ychecker', 'tinymcespellchecker', 'permanentpen', 'powerpaste', 'advtable', 'advcode', 'editimage', 'advtemplate', 'mentions', 'tableofcontents', 'footnotes', 'mergetags', 'autocorrect', 'typography', 'inlinecss', 'markdown','importword', 'exportword', 'exportpdf'
          ],
          toolbar: 'mergetags | undo redo | blocks fontsize | bold italic underline strikethrough',
          mergetags_list: [
            { value: 'first_name', title: 'Имя' },
            { value: 'last_name', title: 'Фамилия' },
            { value: 'birthday', title: 'День рождения' },
            { value: 'email', title: 'Email' },
          ],
        });
      </script>

      {% comment %} <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> {% endcomment %}

      {% comment %} <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script> {% endcomment %}
      {% comment %} <script>
        $(document).ready(function() {
            function getCSRFToken() {
                var name = "csrftoken=";
                var decodedCookie = decodeURIComponent(document.cookie);
                var ca = decodedCookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1);
                    if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
                }
                return "";
            }

            $('#newsletterForm').on('submit', function(event) {
                event.preventDefault();

                var formData = {
                    'subject': $('#subject').val(),
                    'message': $('#message').val()
                };

                $.ajax({
                    type: 'POST',
                    url: '/newsletter/send_newsletter/',
                    data: formData,
                    dataType: 'json',
                    headers: {
                        'X-CSRFToken': getCSRFToken()
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            $('#responseMessage').html('<div class="alert alert-success">Рассылка отправлена!</div>');
                        } else {
                            $('#responseMessage').html('<div class="alert alert-danger">' + response.message + '</div>');
                        }
                    }
                });
            });
        });
        </script> {% endcomment %}
    </main>
  </body>
</html>
